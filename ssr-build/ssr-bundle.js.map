{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"preact\"","webpack:///./libs/polyfill.ts","webpack:///../src/index.js","webpack:///./defines/paint.ts","webpack:///./defines/const.ts","webpack:///./components/canvas.tsx","webpack:///./components/app.tsx","webpack:///./index.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","isPassive","supportPassive","opts","set","window","addEventListener","removeEventListener","e","currentIndex","currentComponent","prevRaf","currentHook","afterPaintEffects","oldBeforeDiff","options","oldBeforeRender","oldAfterDiff","diffed","oldCommit","oldBeforeUnmount","unmount","getHookState","index","type","hooks","length","push","useState","initialState","reducer","init","hookState","_reducer","invokeOrReturn","nextValue","action","setState","useReducer","useEffect","callback","args","state","argsChanged","flushAfterPaintEffects","component","sort","a","b","pop","forEach","invokeCleanup","invokeEffect","vnode","requestAnimationFrame","raf","done","clearTimeout","timeout","HAS_RAF","cancelAnimationFrame","setTimeout","commitQueue","some","filter","cb","hasErrored","hook","comp","cleanup","oldArgs","newArgs","arg","f","PaintReadyState","PaintCursor","LAYER_FLAG_KEY","Canvas","Ready","ctx","strokeStyle","color","lineCap","radius","lineJoin","lineWidth","size","cancelable","preventDefault","setStrokeStyle","button","currentTarget","readyState","x","y","currentLayer","target","getContext","ctxA","activeLayer","id","current","rect","getBoundingClientRect","touches","clientX","left","clientY","top","Math","round","width","offsetWidth","height","offsetHeight","isTransparent","cursor","Eraser","renderData","renderCursor","splice","isRoot","layerId","Play","save","globalCompositeOperation","beginPath","moveTo","changedTouches","lineTo","stroke","ctxO","mainLayer","targetTouches","restore","drawImage","props","cWidth","cHeight","clearRect","paintingLayer","mouseup","forceUpdate","reload","data","allLayer","layer","max","forceReload","renderLength","min","Date","now","Spoid","colorData","getImageData","toString","slice","g","createRef","idx","findIndex","Pen","this","passive","capture","mousedown","mousemove","document","mouseleave","onTouchMove","ref","style","opacity","map","class","onClick","SpoidColor","onTouchStart","display","data-theme","maxLength","onInput","parseInt","undo","redo","clear","createLayer","layer2","deleteLayer","Component","defaultProps","App","title"],"mappings":"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","file":"ssr-bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"qVkA\");\n","module.exports = require(\"preact\");","export function isPassive (): boolean {\r\n\tlet supportPassive = false;\r\n\ttry {\r\n\t\tconst opts = Object.defineProperty({}, \"passive\", {\r\n\t\t\tget: (): boolean => supportPassive,\r\n\t\t\tset: (): void => {\r\n\t\t\t\tsupportPassive = true;\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\twindow.addEventListener(\"testPassive\", () => null, opts);\r\n\t\twindow.removeEventListener(\"testPassive\", () => null, opts);\r\n\t} catch (e) {}\r\n\treturn supportPassive;\r\n}\r\n","import { options } from 'preact';\r\n\r\n/** @type {number} */\r\nlet currentIndex;\r\n\r\n/** @type {import('./internal').Component} */\r\nlet currentComponent;\r\n\r\n/** @type {number} */\r\nlet currentHook = 0;\r\n\r\n/** @type {Array<import('./internal').Component>} */\r\nlet afterPaintEffects = [];\r\n\r\nlet oldBeforeDiff = options._diff;\r\nlet oldBeforeRender = options._render;\r\nlet oldAfterDiff = options.diffed;\r\nlet oldCommit = options._commit;\r\nlet oldBeforeUnmount = options.unmount;\r\n\r\nconst RAF_TIMEOUT = 100;\r\nlet prevRaf;\r\n\r\noptions._diff = vnode => {\r\n\tcurrentComponent = null;\r\n\tif (oldBeforeDiff) oldBeforeDiff(vnode);\r\n};\r\n\r\noptions._render = vnode => {\r\n\tif (oldBeforeRender) oldBeforeRender(vnode);\r\n\r\n\tcurrentComponent = vnode._component;\r\n\tcurrentIndex = 0;\r\n\r\n\tconst hooks = currentComponent.__hooks;\r\n\tif (hooks) {\r\n\t\thooks._pendingEffects.forEach(invokeCleanup);\r\n\t\thooks._pendingEffects.forEach(invokeEffect);\r\n\t\thooks._pendingEffects = [];\r\n\t}\r\n};\r\n\r\noptions.diffed = vnode => {\r\n\tif (oldAfterDiff) oldAfterDiff(vnode);\r\n\r\n\tconst c = vnode._component;\r\n\tif (c && c.__hooks && c.__hooks._pendingEffects.length) {\r\n\t\tafterPaint(afterPaintEffects.push(c));\r\n\t}\r\n\tcurrentComponent = null;\r\n};\r\n\r\noptions._commit = (vnode, commitQueue) => {\r\n\tcommitQueue.some(component => {\r\n\t\ttry {\r\n\t\t\tcomponent._renderCallbacks.forEach(invokeCleanup);\r\n\t\t\tcomponent._renderCallbacks = component._renderCallbacks.filter(cb =>\r\n\t\t\t\tcb._value ? invokeEffect(cb) : true\r\n\t\t\t);\r\n\t\t} catch (e) {\r\n\t\t\tcommitQueue.some(c => {\r\n\t\t\t\tif (c._renderCallbacks) c._renderCallbacks = [];\r\n\t\t\t});\r\n\t\t\tcommitQueue = [];\r\n\t\t\toptions._catchError(e, component._vnode);\r\n\t\t}\r\n\t});\r\n\r\n\tif (oldCommit) oldCommit(vnode, commitQueue);\r\n};\r\n\r\noptions.unmount = vnode => {\r\n\tif (oldBeforeUnmount) oldBeforeUnmount(vnode);\r\n\r\n\tconst c = vnode._component;\r\n\tif (c && c.__hooks) {\r\n\t\tlet hasErrored;\r\n\t\tc.__hooks._list.forEach(s => {\r\n\t\t\ttry {\r\n\t\t\t\tinvokeCleanup(s);\r\n\t\t\t} catch (e) {\r\n\t\t\t\thasErrored = e;\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (hasErrored) options._catchError(hasErrored, c._vnode);\r\n\t}\r\n};\r\n\r\n/**\r\n * Get a hook's state from the currentComponent\r\n * @param {number} index The index of the hook to get\r\n * @param {number} type The index of the hook to get\r\n * @returns {any}\r\n */\r\nfunction getHookState(index, type) {\r\n\tif (options._hook) {\r\n\t\toptions._hook(currentComponent, index, currentHook || type);\r\n\t}\r\n\tcurrentHook = 0;\r\n\r\n\t// Largely inspired by:\r\n\t// * https://github.com/michael-klein/funcy.js/blob/f6be73468e6ec46b0ff5aa3cc4c9baf72a29025a/src/hooks/core_hooks.mjs\r\n\t// * https://github.com/michael-klein/funcy.js/blob/650beaa58c43c33a74820a3c98b3c7079cf2e333/src/renderer.mjs\r\n\t// Other implementations to look at:\r\n\t// * https://codesandbox.io/s/mnox05qp8\r\n\tconst hooks =\r\n\t\tcurrentComponent.__hooks ||\r\n\t\t(currentComponent.__hooks = {\r\n\t\t\t_list: [],\r\n\t\t\t_pendingEffects: []\r\n\t\t});\r\n\r\n\tif (index >= hooks._list.length) {\r\n\t\thooks._list.push({});\r\n\t}\r\n\treturn hooks._list[index];\r\n}\r\n\r\n/**\r\n * @param {import('./index').StateUpdater<any>} [initialState]\r\n */\r\nexport function useState(initialState) {\r\n\tcurrentHook = 1;\r\n\treturn useReducer(invokeOrReturn, initialState);\r\n}\r\n\r\n/**\r\n * @param {import('./index').Reducer<any, any>} reducer\r\n * @param {import('./index').StateUpdater<any>} initialState\r\n * @param {(initialState: any) => void} [init]\r\n * @returns {[ any, (state: any) => void ]}\r\n */\r\nexport function useReducer(reducer, initialState, init) {\r\n\t/** @type {import('./internal').ReducerHookState} */\r\n\tconst hookState = getHookState(currentIndex++, 2);\r\n\thookState._reducer = reducer;\r\n\tif (!hookState._component) {\r\n\t\thookState._value = [\r\n\t\t\t!init ? invokeOrReturn(undefined, initialState) : init(initialState),\r\n\r\n\t\t\taction => {\r\n\t\t\t\tconst nextValue = hookState._reducer(hookState._value[0], action);\r\n\t\t\t\tif (hookState._value[0] !== nextValue) {\r\n\t\t\t\t\thookState._value = [nextValue, hookState._value[1]];\r\n\t\t\t\t\thookState._component.setState({});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t];\r\n\r\n\t\thookState._component = currentComponent;\r\n\t}\r\n\r\n\treturn hookState._value;\r\n}\r\n\r\n/**\r\n * @param {import('./internal').Effect} callback\r\n * @param {any[]} args\r\n */\r\nexport function useEffect(callback, args) {\r\n\t/** @type {import('./internal').EffectHookState} */\r\n\tconst state = getHookState(currentIndex++, 3);\r\n\tif (!options._skipEffects && argsChanged(state._args, args)) {\r\n\t\tstate._value = callback;\r\n\t\tstate._args = args;\r\n\r\n\t\tcurrentComponent.__hooks._pendingEffects.push(state);\r\n\t}\r\n}\r\n\r\n/**\r\n * @param {import('./internal').Effect} callback\r\n * @param {any[]} args\r\n */\r\nexport function useLayoutEffect(callback, args) {\r\n\t/** @type {import('./internal').EffectHookState} */\r\n\tconst state = getHookState(currentIndex++, 4);\r\n\tif (!options._skipEffects && argsChanged(state._args, args)) {\r\n\t\tstate._value = callback;\r\n\t\tstate._args = args;\r\n\r\n\t\tcurrentComponent._renderCallbacks.push(state);\r\n\t}\r\n}\r\n\r\nexport function useRef(initialValue) {\r\n\tcurrentHook = 5;\r\n\treturn useMemo(() => ({ current: initialValue }), []);\r\n}\r\n\r\n/**\r\n * @param {object} ref\r\n * @param {() => object} createHandle\r\n * @param {any[]} args\r\n */\r\nexport function useImperativeHandle(ref, createHandle, args) {\r\n\tcurrentHook = 6;\r\n\tuseLayoutEffect(\r\n\t\t() => {\r\n\t\t\tif (typeof ref == 'function') ref(createHandle());\r\n\t\t\telse if (ref) ref.current = createHandle();\r\n\t\t},\r\n\t\targs == null ? args : args.concat(ref)\r\n\t);\r\n}\r\n\r\n/**\r\n * @param {() => any} factory\r\n * @param {any[]} args\r\n */\r\nexport function useMemo(factory, args) {\r\n\t/** @type {import('./internal').MemoHookState} */\r\n\tconst state = getHookState(currentIndex++, 7);\r\n\tif (argsChanged(state._args, args)) {\r\n\t\tstate._value = factory();\r\n\t\tstate._args = args;\r\n\t\tstate._factory = factory;\r\n\t}\r\n\r\n\treturn state._value;\r\n}\r\n\r\n/**\r\n * @param {() => void} callback\r\n * @param {any[]} args\r\n */\r\nexport function useCallback(callback, args) {\r\n\tcurrentHook = 8;\r\n\treturn useMemo(() => callback, args);\r\n}\r\n\r\n/**\r\n * @param {import('./internal').PreactContext} context\r\n */\r\nexport function useContext(context) {\r\n\tconst provider = currentComponent.context[context._id];\r\n\t// We could skip this call here, but than we'd not call\r\n\t// `options._hook`. We need to do that in order to make\r\n\t// the devtools aware of this hook.\r\n\t/** @type {import('./internal').ContextHookState} */\r\n\tconst state = getHookState(currentIndex++, 9);\r\n\t// The devtools needs access to the context object to\r\n\t// be able to pull of the default value when no provider\r\n\t// is present in the tree.\r\n\tstate._context = context;\r\n\tif (!provider) return context._defaultValue;\r\n\t// This is probably not safe to convert to \"!\"\r\n\tif (state._value == null) {\r\n\t\tstate._value = true;\r\n\t\tprovider.sub(currentComponent);\r\n\t}\r\n\treturn provider.props.value;\r\n}\r\n\r\n/**\r\n * Display a custom label for a custom hook for the devtools panel\r\n * @type {<T>(value: T, cb?: (value: T) => string | number) => void}\r\n */\r\nexport function useDebugValue(value, formatter) {\r\n\tif (options.useDebugValue) {\r\n\t\toptions.useDebugValue(formatter ? formatter(value) : value);\r\n\t}\r\n}\r\n\r\n/**\r\n * @param {(error: any) => void} cb\r\n */\r\nexport function useErrorBoundary(cb) {\r\n\t/** @type {import('./internal').ErrorBoundaryHookState} */\r\n\tconst state = getHookState(currentIndex++, 10);\r\n\tconst errState = useState();\r\n\tstate._value = cb;\r\n\tif (!currentComponent.componentDidCatch) {\r\n\t\tcurrentComponent.componentDidCatch = err => {\r\n\t\t\tif (state._value) state._value(err);\r\n\t\t\terrState[1](err);\r\n\t\t};\r\n\t}\r\n\treturn [\r\n\t\terrState[0],\r\n\t\t() => {\r\n\t\t\terrState[1](undefined);\r\n\t\t}\r\n\t];\r\n}\r\n\r\n/**\r\n * After paint effects consumer.\r\n */\r\nfunction flushAfterPaintEffects() {\r\n\tlet component;\r\n\t// sort the queue by depth (outermost to innermost)\r\n\tafterPaintEffects.sort((a, b) => a._vnode._depth - b._vnode._depth);\r\n\twhile (component = afterPaintEffects.pop()) {\r\n\t\tif (!component._parentDom) continue;\r\n\t\ttry {\r\n\t\t\tcomponent.__hooks._pendingEffects.forEach(invokeCleanup);\r\n\t\t\tcomponent.__hooks._pendingEffects.forEach(invokeEffect);\r\n\t\t\tcomponent.__hooks._pendingEffects = [];\r\n\t\t} catch (e) {\r\n\t\t\tcomponent.__hooks._pendingEffects = [];\r\n\t\t\toptions._catchError(e, component._vnode);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nlet HAS_RAF = typeof requestAnimationFrame == 'function';\r\n\r\n/**\r\n * Schedule a callback to be invoked after the browser has a chance to paint a new frame.\r\n * Do this by combining requestAnimationFrame (rAF) + setTimeout to invoke a callback after\r\n * the next browser frame.\r\n *\r\n * Also, schedule a timeout in parallel to the the rAF to ensure the callback is invoked\r\n * even if RAF doesn't fire (for example if the browser tab is not visible)\r\n *\r\n * @param {() => void} callback\r\n */\r\nfunction afterNextFrame(callback) {\r\n\tconst done = () => {\r\n\t\tclearTimeout(timeout);\r\n\t\tif (HAS_RAF) cancelAnimationFrame(raf);\r\n\t\tsetTimeout(callback);\r\n\t};\r\n\tconst timeout = setTimeout(done, RAF_TIMEOUT);\r\n\r\n\tlet raf;\r\n\tif (HAS_RAF) {\r\n\t\traf = requestAnimationFrame(done);\r\n\t}\r\n}\r\n\r\n// Note: if someone used options.debounceRendering = requestAnimationFrame,\r\n// then effects will ALWAYS run on the NEXT frame instead of the current one, incurring a ~16ms delay.\r\n// Perhaps this is not such a big deal.\r\n/**\r\n * Schedule afterPaintEffects flush after the browser paints\r\n * @param {number} newQueueLength\r\n */\r\nfunction afterPaint(newQueueLength) {\r\n\tif (newQueueLength === 1 || prevRaf !== options.requestAnimationFrame) {\r\n\t\tprevRaf = options.requestAnimationFrame;\r\n\t\t(prevRaf || afterNextFrame)(flushAfterPaintEffects);\r\n\t}\r\n}\r\n\r\n/**\r\n * @param {import('./internal').EffectHookState} hook\r\n */\r\nfunction invokeCleanup(hook) {\r\n\t// A hook cleanup can introduce a call to render which creates a new root, this will call options.vnode\r\n\t// and move the currentComponent away.\r\n\tconst comp = currentComponent;\r\n\tlet cleanup = hook._cleanup;\r\n\tif (typeof cleanup == 'function') {\r\n\t\thook._cleanup = undefined;\r\n\t\tcleanup();\r\n\t}\r\n\tcurrentComponent = comp;\r\n}\r\n\r\n/**\r\n * Invoke a Hook's effect\r\n * @param {import('./internal').EffectHookState} hook\r\n */\r\nfunction invokeEffect(hook) {\r\n\t// A hook call can introduce a call to render which creates a new root, this will call options.vnode\r\n\t// and move the currentComponent away.\r\n\tconst comp = currentComponent;\r\n\thook._cleanup = hook._value();\r\n\tcurrentComponent = comp;\r\n}\r\n\r\n/**\r\n * @param {any[]} oldArgs\r\n * @param {any[]} newArgs\r\n */\r\nfunction argsChanged(oldArgs, newArgs) {\r\n\treturn (\r\n\t\t!oldArgs ||\r\n\t\toldArgs.length !== newArgs.length ||\r\n\t\tnewArgs.some((arg, index) => arg !== oldArgs[index])\r\n\t);\r\n}\r\n\r\nfunction invokeOrReturn(arg, f) {\r\n\treturn typeof f == 'function' ? f(arg) : f;\r\n}\r\n","export interface PaintLocation {\r\n\tx: number;\r\n\ty: number;\r\n\tcolor: string;\r\n\tsize: number;\r\n\tradius: string;\r\n\tisRoot: boolean;\r\n\tisTransparent: boolean;\r\n\tlayerId: string;\r\n}\r\n\r\nexport enum PaintReadyState {\r\n\tReady = \"ready\",\r\n\tPlay = \"play\",\r\n}\r\n\r\nexport enum PaintCursor {\r\n\tPen = \"pen\",\r\n\tSpoid = \"spoid\",\r\n\tEraser = \"eraser\",\r\n}\r\n\r\nexport interface PaintLayer {\r\n\tid: string;\r\n\tname: string;\r\n}\r\n","export const LAYER_FLAG_KEY = \"__layer_\";\r\n","import { Fragment, Component, h, createRef, RefObject } from \"preact\";\r\nimport { isPassive } from \"../libs\";\r\nimport { PaintCursor, PaintLayer, PaintLocation, PaintReadyState } from \"../defines/paint\";\r\nimport { LAYER_FLAG_KEY } from \"../defines/const\";\r\n\r\nimport \"./canvas.scss\";\r\n\r\ninterface CanvasProps {\r\n\tcWidth: number;\r\n\tcHeight: number;\r\n}\r\ninterface CanvasState {\r\n\tcursor: PaintCursor;\r\n\tsize: number;\r\n\tradius: \"round\" | \"square\";\r\n\tcolor: string;\r\n\r\n\tcurrentLayer: PaintLayer;\r\n\tallLayer: PaintLayer[]; \r\n}\r\nexport default class Canvas extends Component<CanvasProps, CanvasState> {\r\n\tprivate mainLayer;\r\n\tprivate paintingLayer;\r\n\r\n\tprivate activeLayer: {\r\n\t\t[key: string]: RefObject<HTMLCanvasElement>;\r\n\t} = {};\r\n\r\n\tprivate readyState: PaintReadyState = PaintReadyState.Ready;\r\n\r\n\tprivate renderData: { [key: string]: PaintLocation[] } = {};\r\n\tprivate renderCursor: { [key: string]: number } = {};\r\n\r\n\tconstructor () {\r\n\t\tsuper();\r\n\r\n\t\tthis.mainLayer  = createRef<HTMLCanvasElement>();\r\n\t\tthis.paintingLayer = createRef<HTMLCanvasElement>();\r\n\r\n\t\tconst layer: PaintLayer = {\r\n\t\t\tid: `${LAYER_FLAG_KEY}${Date.now()}`,\r\n\t\t\tname: \"Layer 1\",\r\n\t\t};\r\n\t\tthis.renderData[layer.id] = [];\r\n\t\tthis.renderCursor[layer.id] = 0;\r\n\t\tthis.activeLayer[layer.id] = createRef<HTMLCanvasElement>();\r\n\r\n\t\tthis.state = {\r\n\t\t\tcolor: \"#0d6efd\",\r\n\t\t\tsize: 10,\r\n\t\t\tcursor: PaintCursor.Pen,\r\n\t\t\tradius: \"round\",\r\n\r\n\t\t\tcurrentLayer: layer,\r\n\t\t\tallLayer: [layer],\r\n\t\t};\r\n\t}\r\n\r\n\tsetStrokeStyle = (ctx: CanvasRenderingContext2D): void => {\r\n\t\tctx.strokeStyle = this.state.color;\r\n\t\tctx.lineCap = this.state.radius;\r\n\t\tctx.lineJoin = \"round\";\r\n\t\tctx.lineWidth = this.state.size;\r\n\t};\r\n\r\n\tmousedown = (e: MouseEvent | TouchEvent): void => {\r\n\t\tif (e.cancelable) e.preventDefault();\r\n\t\tconst state = this.state;\r\n\r\n\t\tconst setStrokeStyle = (ctx: CanvasRenderingContext2D): void => {\r\n\t\t\tctx.strokeStyle = state.color;\r\n\t\t\tctx.lineCap = state.radius;\r\n\t\t\tctx.lineJoin = \"round\";\r\n\t\t\tctx.lineWidth = state.size;\r\n\t\t};\r\n\r\n\t\tif (\"button\" in e && e.button) return;\t// 버튼을 누른상태에서 이벤트 발생 무시\r\n\t\tif (e.currentTarget) {\r\n\t\t\tif (this.readyState !== PaintReadyState.Ready) return;\r\n\t\t\tconst currentLayer = state.currentLayer;\r\n\t\t\t\r\n\t\t\tconst target = e.currentTarget as HTMLCanvasElement;\r\n\t\t\tconst ctx = target.getContext(\"2d\") as CanvasRenderingContext2D;\r\n\r\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n\t\t\tconst ctxA = this.activeLayer[currentLayer.id].current!.getContext(\"2d\")!;\r\n\t\t\t// const ctxO = this.mainLayer.current!.getContext(\"2d\")!;\r\n\r\n\t\t\tsetStrokeStyle(ctx);\r\n\t\t\t// setStrokeStyle(ctxO);\r\n\t\t\tsetStrokeStyle(ctxA);\r\n\r\n\t\t\tlet x, y;\r\n\t\t\tconst rect = target.getBoundingClientRect();\r\n\t\t\tif (\"touches\" in e) {\r\n\t\t\t\tx = e.touches[0].clientX - rect.left;\r\n\t\t\t\ty = e.touches[0].clientY - rect.top;\r\n\t\t\t} else {\r\n\t\t\t\tx = e.clientX - rect.left;\r\n\t\t\t\ty = e.clientY - rect.top;\r\n\t\t\t}\r\n\r\n\t\t\tx = Math.round(x * target.width / target.offsetWidth);\r\n\t\t\ty = Math.round(y * target.height / target.offsetHeight);\r\n\r\n\t\t\tconst isTransparent = state.cursor === PaintCursor.Eraser;\r\n\r\n\t\t\tlet renderData = this.renderData[currentLayer.id];\r\n\t\t\tif (typeof renderData === \"undefined\") {\r\n\t\t\t\tthis.renderData[currentLayer.id] = [];\r\n\t\t\t\trenderData = [];\r\n\t\t\t}\r\n\t\t\tlet renderCursor = this.renderCursor[currentLayer.id];\r\n\t\t\tif (typeof renderCursor === \"undefined\") {\r\n\t\t\t\tthis.renderCursor[currentLayer.id] = 0;\r\n\t\t\t\trenderCursor = 0;\t\r\n\t\t\t}\r\n\r\n\t\t\trenderData.splice(\r\n\t\t\t\trenderCursor,\r\n\t\t\t\trenderData.length - renderCursor,\r\n\t\t\t\t{\r\n\t\t\t\t\tx,\r\n\t\t\t\t\ty,\r\n\t\t\t\t\tcolor: state.color,\r\n\t\t\t\t\tsize: state.size,\r\n\t\t\t\t\tradius: state.radius,\r\n\t\t\t\t\tisRoot: true,\r\n\t\t\t\t\tisTransparent,\r\n\t\t\t\t\tlayerId: state.currentLayer.id,\r\n\t\t\t\t});\r\n\t\t\tconst cursor = renderData.length;\r\n\r\n\t\t\tthis.renderCursor[currentLayer.id] = cursor;\r\n\t\t\tthis.readyState = PaintReadyState.Play;\r\n\r\n\t\t\tif (isTransparent) {\r\n\t\t\t\tctxA.save();\r\n\t\t\t\tctxA.globalCompositeOperation = \"destination-out\";\r\n\t\t\t}\r\n\t\t\tctxA.beginPath();\r\n\t\t\tctxA.moveTo(x, y);\t\t\t\t\t\r\n\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.moveTo(x, y);\r\n\t\t}\r\n\t};\r\n\r\n\tmousemove = (e: MouseEvent | TouchEvent): void => {\r\n\t\te.preventDefault();\r\n\t\tconst state = this.state;\r\n\r\n\t\tif (e.currentTarget) {\r\n\t\t\tif (this.readyState !== PaintReadyState.Play) return;\r\n\t\t\tconst currentLayer = state.currentLayer;\r\n\t\t\t\r\n\t\t\tconst target = e.currentTarget as HTMLCanvasElement;\r\n\t\t\tconst ctx = target.getContext(\"2d\") as CanvasRenderingContext2D;\r\n\r\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n\t\t\tconst ctxA = this.activeLayer[currentLayer.id].current!.getContext(\"2d\")!;\r\n\t\t\t// const ctxO = this.mainLayer.current!.getContext(\"2d\")!;\r\n\t\t\t\r\n\t\t\tlet x, y;\r\n\t\t\tconst rect = target.getBoundingClientRect();\r\n\t\t\tif (\"changedTouches\" in e) {\r\n\t\t\t\tx = e.changedTouches[0].clientX - rect.left;\r\n\t\t\t\ty = e.changedTouches[0].clientY - rect.top;\r\n\t\t\t} else {\r\n\t\t\t\tx = e.clientX - rect.left;\r\n\t\t\t\ty = e.clientY - rect.top;\r\n\t\t\t}\r\n\r\n\t\t\tx = Math.round(x * target.width / target.offsetWidth);\r\n\t\t\ty = Math.round(y * target.height / target.offsetHeight);\r\n\r\n\t\t\tconst isTransparent = state.cursor === PaintCursor.Eraser;\r\n\r\n\t\t\tconst renderData = this.renderData[currentLayer.id];\r\n\t\t\trenderData.push({\r\n\t\t\t\tx,\r\n\t\t\t\ty,\r\n\t\t\t\tcolor: state.color,\r\n\t\t\t\tsize: state.size,\r\n\t\t\t\tradius: state.radius,\r\n\t\t\t\tisRoot: false,\r\n\t\t\t\tisTransparent,\r\n\t\t\t\tlayerId: state.currentLayer.id,\r\n\t\t\t});\r\n\r\n\t\t\tthis.renderCursor[currentLayer.id] = renderData.length;\r\n\r\n\t\t\tctxA.lineTo(x, y);\r\n\t\t\tctxA.stroke();\r\n\t\t\r\n\t\t\tctx.lineTo(x, y);\r\n\t\t\tctx.stroke();\r\n\t\t}\r\n\t};\r\n\r\n\tmouseup = (e: MouseEvent | TouchEvent): void => {\r\n\t\tif (e.cancelable) e.preventDefault();\r\n\t\tconst state = this.state;\r\n\r\n\t\tif (e.currentTarget) {\r\n\t\t\tif (this.readyState !== PaintReadyState.Play) return;\r\n\t\t\tconst currentLayer = state.currentLayer;\r\n\t\t\t\r\n\t\t\tconst target = e.currentTarget as HTMLCanvasElement;\r\n\t\t\tconst ctx = target.getContext(\"2d\") as CanvasRenderingContext2D;\r\n\r\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n\t\t\tconst ctxA = this.activeLayer[currentLayer.id].current!.getContext(\"2d\")!;\r\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n\t\t\tconst ctxO = this.mainLayer.current!.getContext(\"2d\")!;\r\n\r\n\t\t\tlet x, y;\r\n\t\t\tconst rect = target.getBoundingClientRect();\r\n\t\t\tif (\"targetTouches\" in e) {\r\n\t\t\t\tx = e.targetTouches[0].clientX - rect.left;\r\n\t\t\t\ty = e.targetTouches[0].clientY - rect.top;\r\n\t\t\t} else {\r\n\t\t\t\tx = e.clientX - rect.left;\r\n\t\t\t\ty = e.clientY - rect.top;\r\n\t\t\t}\r\n\r\n\t\t\tx = Math.round(x * target.width / target.offsetWidth);\r\n\t\t\ty = Math.round(y * target.height / target.offsetHeight);\r\n\r\n\t\t\tconst isTransparent = state.cursor === PaintCursor.Eraser;\r\n\r\n\t\t\tconst renderData = this.renderData[currentLayer.id];\r\n\t\t\trenderData.push({\r\n\t\t\t\tx,\r\n\t\t\t\ty,\r\n\t\t\t\tcolor: state.color,\r\n\t\t\t\tsize: state.size,\r\n\t\t\t\tradius: state.radius,\r\n\t\t\t\tisRoot: false,\r\n\t\t\t\tisTransparent,\r\n\t\t\t\tlayerId: state.currentLayer.id,\r\n\t\t\t});\r\n\r\n\t\t\tthis.renderCursor[currentLayer.id] = renderData.length;\r\n\t\t\tthis.readyState = PaintReadyState.Ready;\r\n\r\n\t\t\tctxA.lineTo(x, y);\r\n\t\t\tctxA.stroke();\r\n\t\t\tisTransparent && ctxA.restore();\r\n\r\n\t\t\tctx.lineTo(x, y);\r\n\t\t\tctx.stroke();\r\n\r\n\t\t\tctxO.beginPath();\r\n\t\t\tctxO.drawImage(target, 0, 0, this.props.cWidth, this.props.cHeight)\r\n\t\t\t\r\n\t\t\tctx.clearRect(0, 0, this.props.cWidth, this.props.cHeight);\r\n\t\t}\r\n\t};\r\n\r\n\tmouseleave = (e: MouseEvent): void => {\r\n\t\tif (this.readyState !== PaintReadyState.Play) return;\r\n\t\tif (this.paintingLayer.current !== e.currentTarget) this.mouseup(e);\r\n\t};\r\n\r\n\tforceReload = (): void => {\r\n\t\tthis.forceUpdate(() => this.reload());\r\n\t};\r\n\r\n\treload = (): void => {\r\n\t\tconst mainLayer = this.mainLayer.current;\r\n\t\tconst state = this.state;\r\n\t\tif (mainLayer) {\r\n\t\t\tconst ctx = mainLayer.getContext(\"2d\") as CanvasRenderingContext2D;\r\n\t\t\tlet data: PaintLocation | null = null;\r\n\r\n\t\t\tctx.clearRect(0, 0, mainLayer.width, mainLayer.height);\r\n\t\t\tctx.lineJoin = \"round\";\r\n\t\t\tctx.beginPath();\r\n\t\t\tstate.allLayer.forEach((layer) => {\r\n\t\t\t\tconst ctxA = (this.activeLayer[layer.id].current as HTMLCanvasElement).getContext(\"2d\") as CanvasRenderingContext2D;\r\n\r\n\t\t\t\tctxA.clearRect(0, 0, this.props.cWidth, this.props.cHeight);\r\n\t\t\t\tctxA.lineJoin = \"round\";\r\n\t\t\t\tctxA.beginPath();\r\n\r\n\t\t\t\tfor (let cursor = 0; cursor < this.renderCursor[layer.id]; cursor++) {\r\n\t\t\t\t\tdata = this.renderData[layer.id][cursor];\r\n\t\t\t\t\tif (data.isRoot) {\r\n\t\t\t\t\t\tif (cursor !== 0) {\r\n\t\t\t\t\t\t\tctx.stroke();\r\n\t\t\t\t\t\t\tdata.isTransparent && ctx.restore();\r\n\t\t\t\t\t\t\tctx.beginPath();\r\n\r\n\t\t\t\t\t\t\tctxA.stroke();\r\n\t\t\t\t\t\t\tdata.isTransparent && ctxA.restore();\r\n\t\t\t\t\t\t\tctxA.beginPath();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (data.isTransparent) {\r\n\t\t\t\t\t\t\tctx.save();\r\n\t\t\t\t\t\t\tctx.globalCompositeOperation = \"destination-out\";\r\n\t\t\t\t\t\t\tctxA.save();\r\n\t\t\t\t\t\t\tctxA.globalCompositeOperation = \"destination-out\";\r\n\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\tctx.strokeStyle = data.color;\r\n\t\t\t\t\t\tctx.lineWidth = data.size;\r\n\t\t\t\t\t\tctx.lineCap = state.radius;\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tctxA.strokeStyle = data.color;\r\n\t\t\t\t\t\tctxA.lineWidth = data.size;\r\n\t\t\t\t\t\tctxA.lineCap = state.radius;\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tctx.moveTo(data.x, data.y);\r\n\t\t\t\t\t\tctxA.moveTo(data.x, data.y);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tctx.lineTo(data.x, data.y);\r\n\t\t\t\t\t\tctxA.lineTo(data.x, data.y);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tctxA.stroke();\r\n\t\t\t\t(data as unknown as PaintLocation)?.isTransparent && ctxA.restore();\r\n\t\t\t});\r\n\t\t\tctx.stroke();\r\n\t\t\t(data as unknown as PaintLocation)?.isTransparent && ctx.restore();\r\n\t\t}\r\n\t};\r\n\r\n\tundo = (): void => {\r\n\t\tconst currentLayer = this.state.currentLayer;\r\n\t\tlet i = this.renderCursor[currentLayer.id] - 1;\r\n\t\tfor (; i >= 0; i--) {\r\n\t\t\tif (this.renderData[currentLayer.id][i].isRoot) break;\r\n\t\t}\r\n\t\tthis.renderCursor[currentLayer.id] = Math.max(i, 0);\r\n\t\tthis.forceReload();\r\n\t};\r\n\r\n\tredo = (): void => {\r\n\t\tconst currentLayer = this.state.currentLayer;\r\n\t\tconst renderLength = this.renderData[currentLayer.id].length;\r\n\r\n\t\tlet i = this.renderCursor[currentLayer.id] + 1;\r\n\t\tfor (; i < renderLength; i++) {\r\n\t\t\tif (this.renderData[currentLayer.id][i].isRoot) break;\r\n\t\t}\r\n\t\tthis.renderCursor[currentLayer.id] = Math.min(i, renderLength);\r\n\t\tthis.forceReload();\r\n\t};\r\n\r\n\tclear = (): void => {\r\n\t\tconst layer: PaintLayer = {\r\n\t\t\tid: `${LAYER_FLAG_KEY}${Date.now()}`,\r\n\t\t\tname: \"Layer 1\",\r\n\t\t};\r\n\t\tthis.renderData = {\r\n\t\t\t[layer.id]: [],\r\n\t\t};\r\n\t\tthis.renderCursor = {\r\n\t\t\t[layer.id]: 0,\r\n\t\t};\r\n\r\n\r\n\t\tthis.forceReload();\r\n\t};\r\n\r\n\tSpoidColor = (e: MouseEvent | TouchEvent): void => {\r\n\t\te.preventDefault();\r\n\t\tconst state = this.state;\r\n\t\tif (state.cursor === PaintCursor.Spoid) {\r\n\t\t\tif (e.currentTarget) {\r\n\t\t\t\tif (this.readyState !== PaintReadyState.Ready) return;\r\n\t\t\r\n\t\t\t\tconst target = e.currentTarget as HTMLCanvasElement;\r\n\t\t\t\tconst ctx = target.getContext(\"2d\") as CanvasRenderingContext2D;\r\n\r\n\t\t\t\tlet x, y;\r\n\t\t\t\tconst rect = target.getBoundingClientRect();\r\n\t\t\t\tif (\"touches\" in e) {\r\n\t\t\t\t\tx = e.touches[0].clientX - rect.left;\r\n\t\t\t\t\ty = e.touches[0].clientY - rect.top;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tx = e.clientX - rect.left;\r\n\t\t\t\t\ty = e.clientY - rect.top;\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tx = Math.round(x * target.width / target.offsetWidth);\r\n\t\t\t\ty = Math.round(y * target.height / target.offsetHeight);\r\n\t\r\n\t\t\t\tconst imageData = ctx.getImageData(x, y, 1, 1);\r\n\t\t\t\tconst colorData = imageData.data;\r\n\r\n\t\t\t\t// 색상이 없을 경우\r\n\t\t\t\tif (colorData[4] === 0) return;\r\n\r\n\t\t\t\tconst r = `00${colorData[0].toString(16)}`.slice(-2);\r\n\t\t\t\tconst g = `00${colorData[1].toString(16)}`.slice(-2);\r\n\t\t\t\tconst b = `00${colorData[2].toString(16)}`.slice(-2);\r\n\r\n\t\t\t\tthis.setState({\r\n\t\t\t\t\tcolor: `#${r}${g}${b}`, \r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tcreateLayer = (): void => {\r\n\t\tconst id = `${LAYER_FLAG_KEY}${Date.now()}`;\r\n\t\tthis.setState((state) => {\r\n\t\t\tconst allLayer = state.allLayer;\r\n\t\t\tallLayer.push({\r\n\t\t\t\tid,\r\n\t\t\t\tname: `Layer ${allLayer.length + 1}`,\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tallLayer,\r\n\t\t\t};\r\n\t\t}, () => {\r\n\t\t\tthis.renderData[id] = [];\r\n\t\t\tthis.renderCursor[id] = 0;\r\n\t\t\tthis.activeLayer[id] = createRef<HTMLCanvasElement>();\r\n\t\t});\r\n\t};\r\n\r\n\tdeleteLayer = (layerId: string): void => {\r\n\t\tthis.setState((state) => {\r\n\t\t\tconst allLayer = state.allLayer;\r\n\t\t\tconst idx = allLayer.findIndex((layer) => layer.id === layerId);\r\n\t\t\tif (idx > -1) allLayer.splice(idx, 1); \r\n\t\t\treturn {\r\n\t\t\t\tallLayer,\r\n\t\t\t};\r\n\t\t}, () => {\r\n\t\t\tthis.renderData[layerId] && delete this.renderData[layerId];\r\n\t\t\tthis.renderCursor[layerId] && delete this.renderCursor[layerId];\r\n\t\t\tthis.activeLayer[layerId] && delete this.activeLayer[layerId];\r\n\r\n\t\t\tthis.forceReload();\r\n\t\t});\r\n\t}\r\n\r\n\tcomponentDidMount (): void {\r\n\t\tconst paintingLayer = this.paintingLayer.current;\r\n\t\tif (paintingLayer) {\r\n\t\t\tconst passive = isPassive() ? {\r\n\t\t\t\tpassive: false,\r\n\t\t\t\tcapture: false,\r\n\t\t\t} : false;\r\n\r\n\t\t\tpaintingLayer.addEventListener(\"mousedown\", this.mousedown);\r\n\t\t\tpaintingLayer.addEventListener(\"mousemove\", this.mousemove, passive);\r\n\t\t\tpaintingLayer.addEventListener(\"mouseup\", this.mouseup);\r\n\t\t\tdocument.addEventListener(\"mouseup\", this.mouseleave);\r\n\t\t\t\r\n\t\t\tpaintingLayer.addEventListener(\"touchstart\", this.mousedown);\r\n\t\t\tpaintingLayer.addEventListener(\"touchmove\", this.mousemove, passive);\r\n\t\t\tpaintingLayer.addEventListener(\"touchend\", this.mouseup);\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentWillUnmount (): void {\r\n\t\tconst paintingLayer = this.paintingLayer.current;\r\n\t\tif (paintingLayer) {\r\n\t\t\tpaintingLayer.removeEventListener(\"mousedown\", this.mousedown);\r\n\t\t\tpaintingLayer.removeEventListener(\"mousemove\", this.mousemove);\r\n\t\t\tpaintingLayer.removeEventListener(\"mouseup\", this.mouseup);\r\n\t\t\tdocument.removeEventListener(\"mouseup\", this.mouseleave);\r\n\r\n\t\t\tpaintingLayer.removeEventListener(\"touchstart\", this.mousedown);\r\n\t\t\tpaintingLayer.removeEventListener(\"touchmove\", this.mousemove);\r\n\t\t\tpaintingLayer.removeEventListener(\"touchend\", this.mouseup);\r\n\t\t}\r\n\t}\r\n\r\n\trender (props: Readonly<CanvasProps>, state: Readonly<CanvasState>): h.JSX.Element {\r\n\t\treturn <>\r\n\t\t\t<div>\r\n\t\t\t\t<div\r\n\t\t\t\t\tid=\"painting_canvas\"\r\n\t\t\t\t\tonTouchMove={(e): void => {\r\n\t\t\t\t\t\t// scroll issue\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\t<canvas\r\n\t\t\t\t\t\tid=\"main_layer\"\r\n\t\t\t\t\t\twidth={props.cWidth}\r\n\t\t\t\t\t\theight={props.cHeight}\r\n\t\t\t\t\t\tref={this.mainLayer}\r\n\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\topacity: 0,\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t{ state.allLayer.map((layer) => <canvas\r\n\t\t\t\t\t\tclass=\"active_layer\"\r\n\t\t\t\t\t\tref={this.activeLayer[layer.id]}\r\n\t\t\t\t\t\tkey={layer.id}\r\n\t\t\t\t\t\twidth={props.cWidth}\r\n\t\t\t\t\t\theight={props.cHeight}\r\n\t\t\t\t\t\tonClick={this.SpoidColor}\r\n\t\t\t\t\t\tonTouchStart={this.SpoidColor}\r\n\t\t\t\t\t/> )}\r\n\t\t\t\t\t<canvas\r\n\t\t\t\t\t\tid=\"painting_layer\"\r\n\t\t\t\t\t\twidth={props.cWidth}\r\n\t\t\t\t\t\theight={props.cHeight}\r\n\t\t\t\t\t\tref={this.paintingLayer}\r\n\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\tdisplay: state.cursor === PaintCursor.Spoid ? \"none\" : \"block\",\r\n\t\t\t\t\t\t\topacity: 0,\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div id=\"tool_menu\">\r\n\t\t\t\t<button data-theme=\"purple\" onClick={(): void => this.setState({ cursor: PaintCursor.Pen })}>\r\n\t\t\t\t\tPen\r\n\t\t\t\t</button>\r\n\t\t\t\t<button data-theme=\"purple\" onClick={(): void => this.setState({ cursor: PaintCursor.Spoid })}>\r\n\t\t\t\t\tSpoid\r\n\t\t\t\t</button>\r\n\t\t\t\t<button data-theme=\"purple\" onClick={(): void => this.setState({ cursor: PaintCursor.Eraser })}>\r\n\t\t\t\t\tEraser\r\n\t\t\t\t</button>\r\n\t\t\t\t<div class=\"colorful\">\r\n\t\t\t\t\t<input type=\"input\" maxLength={7} value={state.color} onInput={(e): void => {\r\n\t\t\t\t\t\tconst target = e.target as HTMLInputElement;\r\n\t\t\t\t\t\tthis.setState({ color: target.value });\r\n\t\t\t\t\t}} />\r\n\t\t\t\t\t<span class=\"preview_colorful\" style={`background: ${state.color}`} />\r\n\t\t\t\t</div>\t\r\n\t\t\t\t<input type=\"number\" min={0} max={100} maxLength={3} value={state.size} onInput={(e): void => {\r\n\t\t\t\t\tconst target = e.target as HTMLInputElement;\r\n\t\t\t\t\tthis.setState({ size: parseInt(target.value, 10) });\r\n\t\t\t\t}} />\r\n\t\t\t\t<button data-theme=\"green\" onClick={(): void => this.setState({ radius: \"round\" })}>\r\n\t\t\t\t\tRound\r\n\t\t\t\t</button>\r\n\t\t\t\t<button data-theme=\"green\" onClick={(): void => this.setState({ radius: \"square\" })}>\r\n\t\t\t\t\tSquare\r\n\t\t\t\t</button>\r\n\t\t\t\t<button onClick={(): void => this.undo()}>\r\n\t\t\t\t\tUndo\r\n\t\t\t\t</button>\r\n\t\t\t\t<button onClick={(): void => this.redo()}>\r\n\t\t\t\t\tRedo\r\n\t\t\t\t</button>\r\n\t\t\t\t<button onClick={(): void => this.clear()}>\r\n\t\t\t\t\tClear\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\t\t\t<div id=\"layer_menu\">\r\n\t\t\t\t<button onClick={(): void => this.createLayer()}>\r\n\t\t\t\t\tCreate\r\n\t\t\t\t</button>\r\n\t\t\t\t<button data-theme=\"green\" onClick={(): void => this.setState((state) => {\r\n\t\t\t\t\tconst allLayer = state.allLayer;\r\n\t\t\t\t\tconst idx = allLayer.findIndex((layer2) => state.currentLayer.id === layer2.id);\r\n\t\t\t\t\tif (idx > 0) {\r\n\t\t\t\t\t\tconst target = allLayer.splice(idx, 1)[0];\r\n\t\t\t\t\t\tallLayer.splice(idx - 1, 0, target);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tallLayer,\r\n\t\t\t\t\t};\r\n\t\t\t\t}, () => this.reload())}>\r\n\t\t\t\t\tUP\r\n\t\t\t\t</button>\r\n\t\t\t\t<button data-theme=\"green\"  onClick={(): void => this.setState((state) => {\r\n\t\t\t\t\tconst allLayer = state.allLayer;\r\n\t\t\t\t\tconst idx = allLayer.findIndex((layer2) => state.currentLayer.id === layer2.id);\r\n\t\t\t\t\tif (idx > -1 && idx + 1 < allLayer.length) {\r\n\t\t\t\t\t\tconst target = allLayer.splice(idx, 1)[0];\r\n\t\t\t\t\t\tallLayer.splice(idx + 1, 0, target);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tallLayer,\r\n\t\t\t\t\t};\r\n\t\t\t\t}, () => this.reload())}>\r\n\t\t\t\t\tDOWN\r\n\t\t\t\t</button>\r\n\t\t\t\t<ul>\r\n\t\t\t\t\t{ state.allLayer.map((layer) => <li\r\n\t\t\t\t\t\tkey={layer.id}\r\n\t\t\t\t\t\tclass={`layer_item ${layer.id === state.currentLayer.id ? \"selected\" : \"\"}`}\r\n\t\t\t\t\t\tonClick={(): void => this.setState({\r\n\t\t\t\t\t\t\tcurrentLayer: layer,\r\n\t\t\t\t\t\t})}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{layer.name}\r\n\t\t\t\t\t\t<span onClick={(): void => this.deleteLayer(layer.id)}>삭제</span>\r\n\t\t\t\t\t</li>)}\r\n\t\t\t\t</ul>\r\n\t\t\t</div>\r\n\t\t</>;\r\n\t}\r\n}\r\n\r\nCanvas.defaultProps = {\r\n\tcWidth: 1920,\r\n\tcHeight: 1080,\r\n};\r\n","import { FunctionalComponent, h } from \"preact\";\r\nimport { useEffect } from \"preact/hooks\";\r\n\r\nimport Canvas from \"./canvas\";\r\n\r\nimport \"./app.scss\";\r\n\r\nconst App: FunctionalComponent = () => {\r\n\tuseEffect(() => {\r\n\t\tdocument.title = \"Quick Drawing\";\r\n\t}, []);\r\n\treturn (\r\n\t\t<div id=\"app\">\r\n\t\t\t<Canvas cWidth={1920} cHeight={1080} />\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default App;\r\n","import './style/index.css';\nimport App from './components/app';\n\nexport default App;\n"],"sourceRoot":""}